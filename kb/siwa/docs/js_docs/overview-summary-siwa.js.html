<!doctype html public "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<html>
<head>
<title>
 Overview
</title>
<link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<script>
function asd() {
	
		parent.document.title="siwa.js Overview";
	
}
</script>
</head>
<body bgcolor="white" onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> 	<font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top">
<em>
<b></b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<center>
	
	   <h2>siwa.js</h2>
	
</center>

	


<h4>Summary</h4>
<p>
	
		No overview generated for 'siwa.js'<BR/><BR/>
	
</p>

<hr>



<!-- ========== METHOD SUMMARY =========== -->

	<a name="method_summary"><!-- --></a>
	<table border="1" cellpadding="3" cellspacing="0" width="100%">
		<tr bgcolor="#CCCCFF" class="TableHeadingColor">
			<td colspan=2>
				<font size="+2">
					<b>Method Summary</b>
				</font>
			</td>
		</tr>
	
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!checkExtraConditions">checkExtraConditions</a></b>(extraConditions, theTrigger)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Checks the extra conditions of a service.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!createDiv">createDiv</a></b>(divID, contents)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Adds a DIV block to the DOM to put embed/thumbnail objects in.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!createInputElement">createInputElement</a></b>(form, name, value)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Creates an input element for form (used in runPostService())
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!executeJsonReq">executeJsonReq</a></b>()
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 If no JSON request is processed, but if there is a request pending, process the request.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!getJsonResponse">getJsonResponse</a></b>(response)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Fetches the response of a JSON request.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!getServiceByLabel">getServiceByLabel</a></b>(serviceLabel)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Get a specific Service Description of a single Service.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!getServices">getServices</a></b>()
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Get the Services Descriptions object
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!getTriggerByValue">getTriggerByValue</a></b>(triggerValue)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Returns the Metadata field name by providing its contents.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!getValueOfField">getValueOfField</a></b>(service, field)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Gets the value of a specific Services Description field.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!getValueOfMDF">getValueOfMDF</a></b>(input)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Get the value of a Metadata field by its name.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!includeCSS">includeCSS</a></b>(filename)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Adds a CSS/Style link to the HEAD of the DOM.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!includeJS">includeJS</a></b>(filename)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Adds a Javascript link to the HEAD of the DOM.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!initializeSpans">initializeSpans</a></b>()
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Adds the onclick functionality to spans with the class name "siwa".
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!initServices">initServices</a></b>(doc, servicesUrl, styleUrl, proxyUrl, sessionVars)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Initialize the software.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!invokeService">invokeService</a></b>(servLabel, id, value)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Invokes a service by going thru its description.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!isArray">isArray</a></b>(obj)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Checks if the object given is an array by checking its constructor.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!loadSessionArray">loadSessionArray</a></b>(sessionVars)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Loads the Session Variables Array and sets some defaults if the were not already given.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!lookupEntryInMap">lookupEntryInMap</a></b>(entry, map)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Helper method for the lookup table functionality of the parameters.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!parseParameter">parseParameter</a></b>(parameter, triggerValue)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Process the several parameter types such as field, fixed, lookup, replace and parts.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!parseParValue">parseParValue</a></b>(parValue, triggerValue)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Parses the contents of a parameter for substituting purposes.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!print_r">print_r</a></b>(theObj)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 A Javascript implementation of the PHP method print_r.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!readServices">readServices</a></b>(url)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Wrapper for including the Services Descriptions object.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!runGetService">runGetService</a></b>(service, id, value)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Processes a service with access type GET.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!runJsonService">runJsonService</a></b>(service, id, value)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Processes a service with access type JSON.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!runOaiService">runOaiService</a></b>(service, id, value)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!runOpenSearchService">runOpenSearchService</a></b>(service, id, value)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!runPostService">runPostService</a></b>(service, id, value)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Processes a service with access type POST.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!runSoapService">runSoapService</a></b>(service, id, value)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!runSparqlService">runSparqlService</a></b>(service, id, value)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!searchItem">searchItem</a></b>(searchPhrase)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Helper function to be able to use createSearchList functionality to continue the search on the website.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!servRequest">servRequest</a></b>(e)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Wrapper for loading the context menu.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;void</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!setServices">setServices</a></b>(servs)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Function invoked by the callback when retrieving the Services Descriptions as a JSON object.
		      </td>
		   </tr>
		
		   <tr bgcolor="white" class="TableRowColor">
		      <td align="right" valign="top" width="1%">
			 <font size="-1">
			    <code>static&nbsp;Object</code>
			 </font>
		      </td>
		      <td>
			 <code>
			    <b>
			       <a href="GLOBALS.html#!s!trim">trim</a></b>(value)
			 </code>
			 <br>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 Trims a String.
		      </td>
		   </tr>
		
	
	</table>
    <p>

<!-- ========== END METHOD SUMMARY =========== -->


        <pre class="sourceview">&lt;!--

<span class="comment">/**
 * SIWA Software, version 0.9
 * Last update: April 16th, 2010
 *
 * Developer: Thomas Beekman, The National Library of the Netherlands
 * E-mail: tsbeekman<span class="attrib">@gmail</span>.com
 * Date: December 2009 - April 2010
 *
 * This software manages the Services Integration on a particular portal by reading a JSON version of the
 * SIWA (Scheme for Integration of Web Applications, http://dev.theeuropeanlibrary.org/siwa/) Services.xml,
 * adding the onclick function to the siwa spans implementing a context menu and interpreting the descriptions
 * in order to invoke the services requested. This software depends on the following files;
 *
 * SIWA Software
 * - siwa.js: The main code which initializes the services and hooks itself onto spans of the class siwa;
 * - cmenu.js: The code for generating the context menu, which is shown when the user clicks on a siwa span;
 * - proxy.js: The code how to use the proxy, if any;
 * - cmenu.css: The style code for the context menu and the siwa spans.
 *
 * ServicesServer
 * - This code will serve the services.xml with the Services Descriptions in it, and is able to translate
 *   it to a JSON Object which can be used by the SIWA Software and can be edited by the user. 
 */</span>

    <span class="comment">/**####################
	#	Global Variables  #
	#####################*/</span>

<span class="comment">// Main config</span>
var siwaUrl = <span class="literal">"http://81.204.248.129/siwa/"</span>; 												<span class="comment">// The location of the .JS files	</span>
var ssUrl = <span class="literal">"http://81.204.248.129/servicesserver/services.php"</span>; 							<span class="comment">// PHP Version of the ServicesServer</span>
<span class="comment">//var ssUrl = "http://www.kbresearch.nl/servicesserver/services"; 							// JAVA Version of the ServicesServer</span>
var searchUrl = <span class="literal">"http://www.europeana.eu/portal/brief-doc.html?start=1&amp;view=table&amp;query="</span>	<span class="comment">// URL for direct searching when a search phrase has been provided</span>
	
<span class="comment">// Services &amp; document holders</span>
var services; 				<span class="comment">// Will hold the JSON object containing all services descriptions</span>
var pageDoc; 				<span class="comment">// Pointer to the DOM DOC of the page holding the metadata fields</span>

<span class="comment">// Session holder</span>
var sessionArray = []; 		<span class="comment">// Container for Session Variables such as _query</span>

<span class="comment">// Json Request holders</span>
var jsonRequests = []; 		<span class="comment">// Queue for pending JSON queries</span>
var jsonReqBusy = false; 	<span class="comment">// Check whether the JSON queue is being processed</span>

<span class="comment">// Proxy Config</span>
var proxyEnabled = false; 	<span class="comment">// Check whether the Proxy functionality is enabled</span>

<span class="comment">// Text brackets for replaceText</span>
var leftBracket = <span class="literal">"|{| "</span>; 	<span class="comment">// Indicator for recognizing transformed text when performing a httpReq</span>
var rightBracket = <span class="literal">" |}|"</span>; 	<span class="comment">// Indicator for recognizing transformed text when performing a httpReq</span>


	<span class="comment">/**##################
	# Include functions #
	###################*/</span>
	
<span class="comment">/**
 * Adds a Javascript link to the HEAD of the DOM.
 * <span class="attrib">@param</span> fileName the URL to the Javascript that is to be included.
 */</span>
<span class="reserved">function</span> includeJS(filename) {		
	var jsFile = pageDoc.createElement(<span class="literal">'script'</span>);
	jsFile.setAttribute(<span class="literal">"src"</span>, filename);
	jsFile.setAttribute(<span class="literal">"type"</span>, <span class="literal">"text/javascript"</span>);
	pageDoc.getElementsByTagName(<span class="literal">"head"</span>)[0].appendChild(jsFile);	
}

<span class="comment">/**
 * Adds a CSS/Style link to the HEAD of the DOM.
 * <span class="attrib">@param</span> fileName the URL to the CSS/Style file that is to be included.
 */</span>
<span class="reserved">function</span> includeCSS(filename) {		
	var cssFile = pageDoc.createElement(<span class="literal">'link'</span>);
	cssFile.setAttribute(<span class="literal">"rel"</span>, <span class="literal">"stylesheet"</span>);
    cssFile.setAttribute(<span class="literal">"type"</span>, <span class="literal">"text/css"</span>);
    cssFile.setAttribute(<span class="literal">"href"</span>, filename);
	pageDoc.getElementsByTagName(<span class="literal">"head"</span>)[0].appendChild(cssFile);
}

<span class="comment">/**
 * Adds a DIV block to the DOM to put embed/thumbnail objects in.
 * <span class="attrib">@param</span> divID of the DIV to be created.
 */</span>
<span class="reserved">function</span> createDiv(divID, contents) {
	var i = 0;
	
	<span class="reserved">while</span> (pageDoc.getElementById(divID + i) != null) {
		i++;		
	}
	divID = divID + i;
	var newDiv = pageDoc.createElement(<span class="literal">"div"</span>);
	newDiv.setAttribute(<span class="literal">"id"</span>, divID);	
	newDiv.setAttribute(<span class="literal">"class"</span>, <span class="literal">"siwadiv"</span>);	
	newDiv.innerHTML = contents;	
		
	<span class="reserved">if</span> (pageDoc.getElementById(<span class="literal">"cmenu"</span>) != null) {		
		newDiv.style.top = pageDoc.getElementById(<span class="literal">"cmenu"</span>).style.top;	
		newDiv.style.left = pageDoc.getElementById(<span class="literal">"cmenu"</span>).style.left;			
	} 		
	
	newDiv.onclick = <span class="reserved">function</span>() { pageDoc.body.removeChild(newDiv); }
	pageDoc.body.appendChild(newDiv);	
}


	<span class="comment">/**###########################
	# Service Specific Functions # 
	############################*/</span>

<span class="comment">/**
 * Get the Services Descriptions object
 * <span class="attrib">@return</span> services object containing the services descriptions
 */</span>
<span class="reserved">function</span> getServices() { <span class="reserved">return</span> services; }

<span class="comment">/**
 * Get a specific Service Description of a single Service.
 * <span class="attrib">@param</span> serviceLabel The label of the Service Description to be returned.
 * <span class="attrib">@return</span> if found, the complete Service Description of the requested Service, else an empty String.
 */</span>
<span class="reserved">function</span> getServiceByLabel(serviceLabel) {
	<span class="reserved">for</span> (var i=0; i&lt;services.length;i++) {
		var service = services[i];		
		<span class="comment">//if (service["sd:serviceLabel"].indexOf(serviceLabel) != -1)	{				</span>
		<span class="reserved">if</span> (service[<span class="literal">"sd:serviceLabel"</span>] == serviceLabel)	{				
			<span class="reserved">return</span> service;				
		}
	}
	<span class="reserved">return</span> <span class="literal">""</span>;
}

<span class="comment">/**
 * Initialize the software. To be invoked by the page containing the metadata fields.
 * <span class="attrib">@param</span> doc a pointer to the DOM Document of the page the metadata fields.
 * <span class="attrib">@param</span> servicesUrl the URL or version of the Services.xml which the software should use.
 * <span class="attrib">@param</span> styleUrl the URL of the CSS/Style file to be used.
 * <span class="attrib">@param</span> proxyUrl the URL of the Javascript Proxy implementation code.
 * <span class="attrib">@param</span> sessionVars an object container for session variables like _query or language.
 */</span>
<span class="reserved">function</span> initServices(doc, servicesUrl, styleUrl, proxyUrl, sessionVars) { 		
	pageDoc = doc;
		
	<span class="comment">// Load Session Variables, create the object if no sessionVars are provided</span>
	<span class="reserved">if</span> (sessionVars == null) {
		var sessionVars = [];
	}	
	loadSessionArray(sessionVars);
	
	<span class="reserved">if</span> (sessionVars[<span class="literal">"ssurl"</span>] != null) {
		ssUrl = sessionVars[<span class="literal">"ssurl"</span>];
	}
	
	<span class="comment">// Load CSS/Style file</span>
	<span class="reserved">if</span> (styleUrl == <span class="literal">""</span> || styleUrl == null)	{	
		includeCSS(siwaUrl + <span class="literal">"siwa.css"</span>);
	} <span class="reserved">else</span> {
		includeCSS(styleUrl);	
	}
	
	<span class="comment">// Load Context Menu code	</span>
	includeJS(siwaUrl + <span class="literal">"cmenu.js"</span>);		
	
	<span class="comment">// Load Proxy code</span>
	<span class="reserved">if</span> (proxyUrl != null &amp;&amp; proxyUrl != <span class="literal">""</span>) {
		<span class="comment">// Todo: A thorough check whether the proxy file has implemented all functions (typeof yourFunctionName == 'function')</span>
		proxyEnabled = true;
		includeJS(proxyUrl);
	}
	
	<span class="comment">// Load the Services.xml</span>
	<span class="reserved">if</span> (servicesUrl == <span class="literal">""</span> || servicesUrl == null) {
		readServices(ssUrl + <span class="literal">"?format=json&amp;callback=setServices"</span>);			
	} <span class="reserved">else</span> {		
		<span class="reserved">if</span> (servicesUrl.indexOf(<span class="literal">"http://"</span>) != -1) {			
			readServices(ssUrl + <span class="literal">"?format=json&amp;callback=setServices&amp;src="</span> + servicesUrl);		
		} <span class="reserved">else</span> {
			readServices(ssUrl + <span class="literal">"?format=json&amp;callback=setServices&amp;version="</span> + servicesUrl);		
		}
	}
	
}

<span class="comment">/**
 * Loads the Session Variables Array and sets some defaults if the were not already given.
 * <span class="attrib">@param</span> sessionVars the Session Variables Array.
 */</span>
<span class="reserved">function</span> loadSessionArray(sessionVars) {
	sessionArray = sessionVars;	
	
	<span class="comment">// Set a few defaults if these sessionVars are not already provided</span>
	sessionArray[<span class="literal">"srcLang639_1"</span>] = sessionArray[<span class="literal">"srcLang639_1"</span>] ? sessionArray[<span class="literal">"srcLang639_1"</span>] : <span class="literal">"nl"</span>;
	sessionArray[<span class="literal">"userLang639_1"</span>] = sessionArray[<span class="literal">"userLang639_1"</span>] ? sessionArray[<span class="literal">"userLang639_1"</span>] : <span class="literal">"en"</span>;
	sessionArray[<span class="literal">"srcLangFull"</span>] = sessionArray[<span class="literal">"srcLangFull"</span>] ? sessionArray[<span class="literal">"srcLangFull"</span>] : <span class="literal">"Dutch"</span>;
	sessionArray[<span class="literal">"userLangFull"</span>] = sessionArray[<span class="literal">"userLangFull"</span>] ? sessionArray[<span class="literal">"userLangFull"</span>] : <span class="literal">"English"</span>;	
}

<span class="comment">/**
 * Wrapper for loading the context menu. To be invoked on onclick/onmouseover events.
 * <span class="attrib">@param</span> e the event object of the trigger.
 */</span>
<span class="reserved">function</span> servRequest(e) {			
	e = e ? e : window.event;		
	showContextMenu(e);		
}

<span class="comment">/**
 * Wrapper for including the Services Descriptions object.
 * <span class="attrib">@param</span> url the URL of the JSON object containing the Services Descriptions. The callback should be set to setServices.
 */</span>
<span class="reserved">function</span> readServices(url) { includeJS(url); }

<span class="comment">/**
 * Function invoked by the callback when retrieving the Services Descriptions as a JSON object.
 * <span class="attrib">@param</span> servs the Services Descriptions in JSON format.
 */</span>
<span class="reserved">function</span> setServices(servs) {
	services = eval(servs);		
	initializeSpans();	
	
	<span class="reserved">if</span> (services[<span class="literal">"sd:service"</span>] != null) {
		services = services[<span class="literal">"sd:service"</span>];
	}
		
	<span class="comment">// Invoke Automatic services		</span>
	<span class="reserved">for</span> (var i=0; i&lt;services.length; i++) {
		var service = services[i];		
		
		<span class="reserved">if</span> (service[<span class="literal">"sd:invocation"</span>] != null) {
			var invocation = service[<span class="literal">"sd:invocation"</span>].toLowerCase();
			
			<span class="reserved">if</span> (invocation.indexOf(<span class="literal">"automatic"</span>) != -1) {					
				var typeOfUse = service[<span class="literal">"sd:typeOfUse"</span>] ? service[<span class="literal">"sd:typeOfUse"</span>].toLowerCase() : <span class="literal">""</span>;
				var accessType = service[<span class="literal">"sd:accessType"</span>] ? service[<span class="literal">"sd:accessType"</span>].toLowerCase() : <span class="literal">""</span>;
				
				<span class="reserved">if</span> ((typeOfUse != <span class="literal">"linkonly"</span>) &amp;&amp; (typeOfUse != <span class="literal">"thumbnail"</span>) &amp;&amp; (proxyEnabled != true) &amp;&amp; (accessType != <span class="literal">"json"</span>)) {
					service[<span class="literal">"sd:invocation"</span>] = <span class="literal">"option"</span>;												
				} <span class="reserved">else</span> {				
					var triggers = service[<span class="literal">"sd:triggers"</span>][<span class="literal">"sd:trigger"</span>];
									
					<span class="comment">// Loop through Metadata Fields</span>
					spanArray = pageDoc.getElementsByTagName(<span class="literal">"span"</span>);	
					<span class="reserved">for</span> (var j=0; j&lt;spanArray.length; j++) {
						var currSpan = spanArray[j];
						var theTrigger = currSpan.getAttribute(<span class="literal">"name"</span>) ? currSpan.getAttribute(<span class="literal">"name"</span>) : <span class="literal">""</span>;						
						var strippedTrigger = theTrigger;
							
						strippedTrigger = strippedTrigger.replace(<span class="literal">"europeana:"</span>, <span class="literal">""</span>);
						strippedTrigger = strippedTrigger.replace(<span class="literal">"dcterms:"</span>, <span class="literal">""</span>);
						strippedTrigger = strippedTrigger.replace(<span class="literal">"dc:"</span>, <span class="literal">""</span>);	
											
						<span class="reserved">if</span> ((spanArray[j].className == <span class="literal">"siwa"</span>) &amp;&amp; (strippedTrigger != null)) {
							<span class="reserved">if</span> ((in_array(strippedTrigger, triggers)) || (in_array(<span class="literal">"*"</span>, triggers))) {
								invkService = true;
															
								<span class="reserved">if</span> ((service[<span class="literal">"sd:extraConditions"</span>] != null) &amp;&amp; (service[<span class="literal">"sd:extraConditions"</span>][<span class="literal">"sd:extraCondition"</span>] != null)) {
									var extraConditions = service[<span class="literal">"sd:extraConditions"</span>][<span class="literal">"sd:extraCondition"</span>];
									<span class="reserved">if</span> (checkExtraConditions(extraConditions, theTrigger) == false) {										
										invkService = false;
									}
								}
								<span class="reserved">if</span> (invkService) {
									var servLabel = service[<span class="literal">"sd:serviceLabel"</span>];
									var id = currSpan.getAttribute(<span class="literal">"id"</span>);
									var value = currSpan.innerHTML;																
									invokeService(servLabel, id, value);									
								}
							}
						}
					}
				}				
			}			
		}		
	}	
}

<span class="comment">/**
 * Checks the extra conditions of a service.
 * <span class="attrib">@param</span> extraConditions the extra conditions of a service, can be an array or a single condition.
 * <span class="attrib">@param</span> theTrigger the Metadata field that triggered the service.
 * <span class="attrib">@return</span> true if extra conditions are met, false if the service should not be invoked.
 */</span>
<span class="reserved">function</span> checkExtraConditions(extraConditions, theTrigger) {	
	var invkService = true;
	<span class="reserved">if</span> (isArray(extraConditions)) {		
		<span class="reserved">for</span> (var i=0; i&lt;extraConditions.length; i++) {
			var extraCondition = extraConditions[i];
			<span class="reserved">if</span> ((extraCondition[<span class="literal">"@field"</span>] != null) &amp;&amp; (extraCondition[<span class="literal">"#text"</span>] != null)){
				var ecHaystack = getValueOfMDF(extraCondition[<span class="literal">"@field"</span>]).toLowerCase();
				var ecNeedle = extraCondition[<span class="literal">"#text"</span>].toLowerCase();
				<span class="reserved">if</span> (ecHaystack.indexOf(ecNeedle) == -1)
					invkService = false;				
			} <span class="reserved">else</span> {
				var ecHaystack = getValueOfMDF(theTrigger);
				var ecNeedle = extraCondition.toLowerCase();
				<span class="reserved">if</span> (ecNeedle == <span class="literal">"_noHits"</span>) {
					<span class="comment">// TODO: _noHits implementation</span>
				} <span class="reserved">else</span> {
					<span class="reserved">if</span> (ecHaystack.indexOf(ecNeedle) == -1)
						invkService = false;
				}
			}			
		}			
	} <span class="reserved">else</span> {		
		<span class="reserved">if</span> ((extraConditions[<span class="literal">"@field"</span>] != null) &amp;&amp; (extraConditions[<span class="literal">"#text"</span>] != null)) {
			var ecHaystack = getValueOfMDF(extraConditions[<span class="literal">"@field"</span>]).toLowerCase();
			var ecNeedle = extraConditions[<span class="literal">"#text"</span>].toLowerCase();
			<span class="reserved">if</span> (ecNeedle == <span class="literal">"_noHits"</span>) {
				<span class="comment">// TODO: _noHits implementation	</span>
			} <span class="reserved">else</span> <span class="reserved">if</span> (ecHaystack.indexOf(ecNeedle) == -1) {
				invkService = false;		
			}			 
		} <span class="reserved">else</span> {
			
			var ecHaystack = getValueOfMDF(theTrigger).toLowerCase();						
			var ecNeedle = extraConditions.toLowerCase();
			<span class="reserved">if</span> (ecNeedle == <span class="literal">"_noHits"</span>) {
				<span class="comment">// TODO: _noHits implementation	</span>
			} <span class="reserved">else</span> <span class="reserved">if</span> (ecHaystack.indexOf(ecNeedle) == -1) {				
				invkService = false;						
			}
		}
	}	
	<span class="reserved">return</span> invkService;
}

<span class="comment">/**
 * Adds the onclick functionality to spans with the class name "siwa".
 */</span>
<span class="reserved">function</span> initializeSpans() {
	spanArray = pageDoc.getElementsByTagName(<span class="literal">"span"</span>);	
	<span class="reserved">for</span> (var i=0; i&lt;spanArray.length; i++) {
		<span class="reserved">if</span> (spanArray[i].className == <span class="literal">"siwa"</span>) {
			var currSpan = spanArray[i];			
			currSpan.onclick = servRequest;			
		}
	}	
}

<span class="comment">/**
 * Invokes a service by going thru its description.
 * <span class="attrib">@param</span> servLabel the unique service label of the service to be invoked (Soon to be replaced by the SID, Service Identifier).
 * <span class="attrib">@param</span> id the ID of the Metadata field which triggered the service. 
 * <span class="attrib">@param</span> value the contents of the Metadata field which triggered the service.
 */</span>
<span class="reserved">function</span> invokeService(servLabel, id, value) {			
	var service = getServiceByLabel(servLabel);
	value = unescape(value);
	
	<span class="reserved">if</span> (service == null) {
		alert(<span class="literal">"Error: The services.xml is corrupt."</span>);
	} <span class="reserved">else</span> {
		var typeOfUse = service[<span class="literal">"sd:typeOfUse"</span>];		<span class="comment">// linkOnly, replaceText, createSearchList etc.						</span>
		var format = service[<span class="literal">"dc:format"</span>];				<span class="comment">// Response format</span>
		var accessType = service[<span class="literal">"sd:accessType"</span>];		<span class="comment">// GET, POST, JSON etc.		</span>
						
		accessType = accessType ? accessType.toUpperCase() : <span class="literal">""</span>;
		
		<span class="comment">// Select the right method for the specific required access type. Default to GET</span>
		switch (accessType) {
			case <span class="literal">"GET"</span>:				
				runGetService(service, id, value);
				break;
			case <span class="literal">"POST"</span>:				
				runPostService(service, id, value);
				break;
			case <span class="literal">"JSON"</span>:				
				runJsonService(service, id, value);
				break;
			case <span class="literal">"OPENSEARCH"</span>:
				alert(<span class="literal">"The service \"</span><span class="literal">" + service["</span>dc:title<span class="literal">"] + "</span>\<span class="literal">" was requested for field \"</span><span class="literal">" + id + "</span>\<span class="literal">".\nAccess-type OpenSearch is not implemented yet. "</span>);
				break;
			case <span class="literal">"SOAP"</span>:
				alert(<span class="literal">"The service \"</span><span class="literal">" + service["</span>dc:title<span class="literal">"] + "</span>\<span class="literal">" was requested for field \"</span><span class="literal">" + id + "</span>\<span class="literal">".\nAccess-type SOAP is not implemented yet. "</span>);
				break;
			case <span class="literal">"OAI"</span>:
				alert(<span class="literal">"The service \"</span><span class="literal">" + service["</span>dc:title<span class="literal">"] + "</span>\<span class="literal">" was requested for field \"</span><span class="literal">" + id + "</span>\<span class="literal">".\nAccess-type OAI is not implemented yet. "</span>);
				break;
			case <span class="literal">"SPARQL"</span>:
				alert(<span class="literal">"The service \"</span><span class="literal">" + service["</span>dc:title<span class="literal">"] + "</span>\<span class="literal">" was requested for field \"</span><span class="literal">" + id + "</span>\<span class="literal">".\nAccess-type SPARQL is not implemented yet. "</span>);
				break;
			default: 
				runGetService(service, id, value);
				break;
		}		
	}	
}

<span class="comment">/**
 * Process the several parameter types such as field, fixed, lookup, replace and parts.
 * <span class="attrib">@param</span> parameter the parameter to process.
 * <span class="attrib">@param</span> triggerValue the value of the Metadata field which triggered the service.
 * <span class="attrib">@return</span> the parsed parameter value.
 */</span>
<span class="reserved">function</span> parseParameter(parameter, triggerValue) {	
	var currParValue = <span class="literal">""</span>;
	
	<span class="reserved">if</span> (parameter[<span class="literal">"#text"</span>] == null) {
		parameter[<span class="literal">"#text"</span>] = <span class="literal">""</span>;
	}
	<span class="comment">// If no parameter type was given; default to field</span>
	<span class="reserved">if</span> (parameter[<span class="literal">"@type"</span>] == null) {
		parameter[<span class="literal">"@type"</span>] = <span class="literal">"field"</span>;
	} 
			
	switch (parameter[<span class="literal">"@type"</span>].toLowerCase()) {		
		case <span class="literal">"field"</span>:
			currParValue = parseParValue(parameter[<span class="literal">"#text"</span>], triggerValue);			
			break;
		case <span class="literal">"prompt"</span>:			
			<span class="comment">//var reply = prompt("");</span>
			alert(<span class="literal">"Prompt not implemented in parseParameter!"</span>);				
			break;
		case <span class="literal">"fixed"</span>:
			currParValue = parameter[<span class="literal">"#text"</span>];
			break;
		case <span class="literal">"lookup"</span>:			
			var keys = parameter[<span class="literal">"sd:keys"</span>][<span class="literal">"sd:key"</span>];		
			var entries = parameter[<span class="literal">"sd:entries"</span>][<span class="literal">"sd:entry"</span>];
			
			<span class="reserved">if</span> (isArray(keys)) {			
				<span class="reserved">for</span> (var i=0; i&lt;keys.length; i++) {
					keys[i] = parseParValue(keys[i], triggerValue);
				}
			} <span class="reserved">else</span> {
				keys = parseParValue(keys, triggerValue);				
			}
			currParValue = lookupEntryInMap(keys, entries);			
			break;	
		case <span class="literal">"replace"</span>:				
			alert(<span class="literal">"Unsupported use of the replace parameter. The replace parameter should only occur in a parts parameter."</span>);
			break;
		case <span class="literal">"replaceby"</span>:
			alert(<span class="literal">"Unsupported use of the replace parameter. The replace parameter should only occur in a parts parameter."</span>);
			break;
		case <span class="literal">"parts"</span>:
			var replaceParmPart = false;
			var replacePart = <span class="literal">""</span>;
			var fieldPart = <span class="literal">""</span>;
			
			<span class="reserved">for</span> (var i=0; i&lt;parameter[<span class="literal">"sd:parmPart"</span>].length; i++) {
				var currParmPart = parameter[<span class="literal">"sd:parmPart"</span>][i];
				<span class="reserved">if</span> (currParmPart[<span class="literal">"@type"</span>] == <span class="literal">"replace"</span>) {
					replaceParmPart = true;
					replacePart = currParmPart[<span class="literal">"#text"</span>];						
				}
				<span class="reserved">else</span> <span class="reserved">if</span> (currParmPart[<span class="literal">"@type"</span>] == <span class="literal">"field"</span>) {
					<span class="reserved">if</span> (replaceParmPart) {
						fieldPart = parseParValue(currParmPart[<span class="literal">"#text"</span>], triggerValue);							
					} <span class="reserved">else</span> {
						<span class="comment">//currParValue += parseParValue(parseParameter(currParmPart, triggerValue));					</span>
						currParValue += parseParameter(currParmPart, triggerValue);					
					}
				}
				<span class="reserved">else</span> <span class="reserved">if</span> (currParmPart[<span class="literal">"@type"</span>] == <span class="literal">"replaceBy"</span>) {
					<span class="comment">// Possible Security Issue TODO						</span>
					fieldPart = eval(<span class="literal">'fieldPart.replace('</span>+replacePart+<span class="literal">',"'</span>+currParmPart[<span class="literal">"#text"</span>]+<span class="literal">'");'</span>);								
					
					currParValue = fieldPart;
					replaceParmPart = false;
					replacePart = <span class="literal">""</span>;
					fieldPart = <span class="literal">""</span>;
				}				
				<span class="reserved">else</span> {
					<span class="comment">//currParValue += parseParValue(parseParameter(currParmPart, triggerValue));		</span>
					currParValue += parseParameter(currParmPart, triggerValue);		
				}
			}							
			break;
		default:
			break;
	}
	
	<span class="comment">//	Process the operation attribute</span>
	<span class="reserved">if</span> (parameter[<span class="literal">"@operation"</span>] != null) {
		switch (parameter[<span class="literal">"@operation"</span>].toLowerCase()) {
			case <span class="literal">"urlencode"</span>:
				currParValue = encodeURIComponent(currParValue);
				break;
			case <span class="literal">"doubleencode"</span>:
				currParValue = encodeURIComponent(encodeURIComponent(currParValue));			
				break;
			default: 
				break;
		}
	}
	
	<span class="reserved">return</span> currParValue;
}

<span class="comment">/**
 * Processes a service with access type GET.
 * <span class="attrib">@param</span> service the service object of the service to be invoked.
 * <span class="attrib">@param</span> id the ID of the Metadata field which triggered the service. 
 * <span class="attrib">@param</span> value the contents of the Metadata field which triggered the service.
 */</span>
<span class="reserved">function</span> runGetService(service, id, value) {
	var identifier = parseParValue(getValueOfField(service, <span class="literal">"dc:identifier"</span>), value);		
	var parArray = service[<span class="literal">"sd:parameters"</span>];
	var parValue;
	var typeOfUse = getValueOfField(service, <span class="literal">"sd:typeOfUse"</span>);
	var	parameters = <span class="literal">""</span>;
	
	identifier = (identifier.indexOf(<span class="literal">"?"</span>) == -1) ? identifier + <span class="literal">"?"</span> : identifier;
	
	<span class="reserved">if</span> (parArray != null) {
		parArray = service[<span class="literal">"sd:parameters"</span>][<span class="literal">"sd:parameter"</span>];		
	} <span class="reserved">else</span> {
		parArray = service[<span class="literal">"sd:parameter"</span>];
	}
		
	value = (proxyEnabled &amp;&amp; (typeOfUse == <span class="literal">"replaceText"</span>)) ? (leftBracket + trim(value) + rightBracket) : (trim(value));	
	
	<span class="comment">// Parse the Parameters (if any)</span>
	<span class="reserved">if</span> (parArray != null) {			
		<span class="reserved">if</span> (isArray(parArray)) {
			<span class="reserved">for</span> (var i=0; i&lt;parArray.length;i++) {
				var currPar = parArray[i];
				parValue = parseParameter(currPar, value);			
				
				<span class="comment">// Check for parameter["<span class="attrib">@substitute</span>"] (for identifier)</span>
				<span class="reserved">if</span> (currPar[<span class="literal">"@substitute"</span>] != null &amp;&amp; currPar[<span class="literal">"@substitute"</span>]) {
					identifier = identifier.replace(currPar[<span class="literal">"@name"</span>], parValue);						
				} <span class="reserved">else</span> {
					parameters += <span class="literal">"&amp;"</span> + currPar[<span class="literal">"@name"</span>] + <span class="literal">"="</span> + parseParameter(currPar, value);				
				}
			}
		} <span class="reserved">else</span> {
			parValue = parseParameter(parArray, value);			
			<span class="reserved">if</span> (parArray[<span class="literal">"@substitute"</span>] != null &amp;&amp; parArray[<span class="literal">"@substitute"</span>]) {
				identifier = identifier.replace(parArray[<span class="literal">"@name"</span>], parValue);													
			} <span class="reserved">else</span> {
			    parameters += <span class="literal">"&amp;"</span> + parArray[<span class="literal">"@name"</span>] + <span class="literal">"="</span> + parValue;
			}
		}
	}
	
	<span class="comment">// Build up the URL</span>
	var url = identifier + parameters;	
	
	<span class="comment">// Check if the Proxy functionality is enabled</span>
	<span class="reserved">if</span> (proxyEnabled) {
		var handler;
		switch (typeOfUse) {			
			case <span class="literal">"debug"</span>:			
				handler = <span class="reserved">function</span>(result) { 
					alert(result); 
				}
				htmlGetReq(url, handler);				
				break;
			case <span class="literal">"alertOccurrences"</span>: 
				<span class="comment">// Get fieldSpec</span>
				var fieldSpec = service[<span class="literal">"sd:fieldSpec"</span>];
								
				<span class="reserved">if</span> ((fieldSpec != null) &amp;&amp; (fieldSpec != <span class="literal">""</span>)) {				
					handler = <span class="reserved">function</span>(result) {
						var numOfOccurrences = 0;
						
						String.<span class="reserved">prototype</span>.count = <span class="reserved">function</span>(char) {
							<span class="reserved">return</span> <span class="reserved">this</span>.split(char).length-1;
						}
						
						alert(result.count(fieldSpec) + <span class="literal">" occurrences of \"</span><span class="literal">" + fieldSpec + "</span>\<span class="literal">" were found."</span>);	
						<span class="comment">// TODO: Invoke nextService if &gt; 0</span>
					}
					htmlGetReq(url, handler);	
				}
				break;
			case <span class="literal">"replaceField"</span>:
				handler = <span class="reserved">function</span>(result) { 
					<span class="comment">// TODO: fieldSpec</span>
					pageDoc.getElementById(id).innerHTML = result;	
				} 
				htmlGetReq(url, handler);				
				break;
			case <span class="literal">"replaceText"</span>:
				handler = <span class="reserved">function</span>(result) { 					
					var begin = 0; var length = 0; var endResult = <span class="literal">""</span>; var tmpResult = <span class="literal">""</span>; value = decodeURIComponent(value);
						
					<span class="reserved">while</span> (result.substr(begin).indexOf(leftBracket) != -1) {						
						begin += result.substr(begin).indexOf(leftBracket) + leftBracket.length;						
						length = result.substr(begin).indexOf(rightBracket);						
						tmpResult = result.substr(begin, length);						
						<span class="reserved">if</span> ((endResult.indexOf(tmpResult) == -1) &amp;&amp; (tmpResult.indexOf(value.substr(leftBracket.length, value.length-(leftBracket.length+rightBracket.length))) == -1)) {
							endResult = (endResult == <span class="literal">""</span>) ? tmpResult : endResult + <span class="literal">"&lt;br&gt;"</span> + tmpResult;													
						}
					}					
					pageDoc.getElementById(id).innerHTML = endResult;						
				} 							
				htmlGetReq(url, handler);				
				break;
			case <span class="literal">"thumbnail"</span>:
				var contents = <span class="literal">"&lt;img src=\"</span><span class="literal">" + url + "</span>\<span class="literal">" alt=\"</span><span class="literal">" + url + "</span>\<span class="literal">" /&gt;"</span>;
				createDiv(<span class="literal">"siwathumbdiv"</span>, contents);				
				break;
			case <span class="literal">"createSearchList"</span>:				
				var fieldSpec = service[<span class="literal">"sd:fieldSpec"</span>];
				
				<span class="reserved">if</span> ((fieldSpec != null) &amp;&amp; (fieldSpec != <span class="literal">""</span>)) {								
					handler = <span class="reserved">function</span>(result) { 
						var fSpecs = fieldSpec.split(<span class="literal">"|"</span>);
						var contents = <span class="literal">"&lt;b&gt;Search list:&lt;/b&gt;&lt;br&gt;"</span>;
																						
						<span class="reserved">for</span> (var i=0; i&lt;fSpecs.length; i++) {
							<span class="reserved">if</span> (result.indexOf(fSpecs[i]) != -1) {
								var tmpStr = result;
								var response = <span class="literal">""</span>;
								
								<span class="reserved">while</span> (tmpStr.indexOf(<span class="literal">"&lt;"</span> + fSpecs[i] + <span class="literal">"&gt;"</span>) != -1) {									
									var firstOcc = tmpStr.indexOf(<span class="literal">"&lt;"</span> + fSpecs[i] + <span class="literal">"&gt;"</span>) + fSpecs[i].length + 2;								
									var tmpStr = tmpStr.substring(firstOcc);
									var endPos = tmpStr.indexOf(<span class="literal">"&lt;/"</span> + fSpecs[i] + <span class="literal">"&gt;"</span>);
									var currValue = tmpStr.substring(0, endPos);
									
									response += <span class="literal">"&lt;b&gt;&lt;li class=\"</span>citem\<span class="literal">" onclick=\"</span>searchItem(<span class="literal">'" + currValue + "'</span>)\<span class="literal">"&gt;"</span> + fSpecs[i] + <span class="literal">": &lt;/b&gt;"</span> + currValue + <span class="literal">"&lt;br&gt;"</span>;								
								}								
																
								<span class="reserved">if</span> (response != <span class="literal">""</span>) {									
									contents += response;
								} <span class="reserved">else</span> {
									contents = <span class="literal">"&lt;b&gt;No results&lt;/b&gt;"</span>;
								}							
							}							
						}
						createDiv(<span class="literal">"csDiv"</span>, contents);								
					} 							
					htmlGetReq(url, handler);										
				}
				break;
			default:
				window.open(url, <span class="literal">""</span>, <span class="literal">""</span>);	
				break;
		}
	} <span class="reserved">else</span> {		
		switch (typeOfUse) {
			case <span class="literal">"thumbnail"</span>:
				var contents = <span class="literal">"&lt;img src=\"</span><span class="literal">" + url + "</span>\<span class="literal">" alt=\"</span><span class="literal">" + url + "</span>\<span class="literal">" /&gt;"</span>;
				createDiv(<span class="literal">"siwathumbdiv"</span>, contents);				
				break;				
			default:
				window.open(url, <span class="literal">""</span>, <span class="literal">""</span>);
				break;
		}
	}
	
	<span class="comment">/* Check for typeOfUse
	 
	 * - alertOccurrences -&gt;
	 * - alertIfResultCount -&gt;
	 * - present -&gt;
	 * - replaceField -&gt; httpRequest with callback value placed in mdf.innerHTML
	 * - replaceText -&gt;
	 * - displayWhenText -&gt;
	 * - createSearchList -&gt;
	 * - embed -&gt;
	 * - thumbnail -&gt;
	 * - expandQuery -&gt;
	 * - addToField -&gt;
	 */</span>
	
	<span class="comment">//window.open(url, "servWindow", "");		</span>
}

<span class="comment">/**
 * Processes a service with access type POST.
 * <span class="attrib">@param</span> service the service object of the service to be invoked.
 * <span class="attrib">@param</span> id the ID of the Metadata field which triggered the service. 
 * <span class="attrib">@param</span> value the contents of the Metadata field which triggered the service.
 */</span>
<span class="reserved">function</span> runPostService(service, id, value) { 
	var identifier = parseParValue(getValueOfField(service, <span class="literal">"dc:identifier"</span>), value);		
	var parArray = service[<span class="literal">"sd:parameters"</span>];
	var typeOfUse = getValueOfField(service, <span class="literal">"sd:typeOfUse"</span>);
	var	parameters = <span class="literal">""</span>;

	identifier = (identifier.indexOf(<span class="literal">"?"</span>) == -1) ? identifier + <span class="literal">"?"</span> : identifier;
	
	<span class="reserved">if</span> (parArray != null) {
		parArray = service[<span class="literal">"sd:parameters"</span>][<span class="literal">"sd:parameter"</span>];		
	} <span class="reserved">else</span> {
		parArray = service[<span class="literal">"sd:parameter"</span>];
	}
	
	value = (proxyEnabled &amp;&amp; (typeOfUse == <span class="literal">"replaceText"</span>)) ? <span class="literal">"|{| "</span> + trim(value) + <span class="literal">" |}|"</span> : value = trim(value);	
	
	<span class="comment">// Create a DOM Document Form</span>
	var form = pageDoc.createElement(<span class="literal">"form"</span>);
	form.action = identifier;
	form.method = <span class="literal">"POST"</span>;
	form.target = <span class="literal">"_blank"</span>;		
		
	<span class="reserved">if</span> (parArray != null) {			
		var parValue;
		<span class="reserved">if</span> (isArray(parArray)) {
			<span class="reserved">for</span> (var i=0; i&lt;parArray.length;i++) {
				var currPar = parArray[i];
				parValue = parseParameter(currPar, value);
				
				<span class="comment">// Check for parameter["<span class="attrib">@substitute</span>"] (for identifier)</span>
				<span class="reserved">if</span> (currPar[<span class="literal">"@substitute"</span>] != null &amp;&amp; currPar[<span class="literal">"@substitute"</span>]) {
					identifier = identifier.replace(currPar[<span class="literal">"@name"</span>], parValue);						
				} <span class="reserved">else</span> {					
					createInputElement(form, parArray[i][<span class="literal">"@name"</span>], parValue);
					parameters += <span class="literal">"&amp;"</span> + currPar[<span class="literal">"@name"</span>] + <span class="literal">"="</span> + parValue;
				}
			}
		} <span class="reserved">else</span> {			
			parValue = parseParameter(parArray, value);			
			
			<span class="reserved">if</span> (parArray[<span class="literal">"@substitute"</span>] != null &amp;&amp; parArray[<span class="literal">"@substitute"</span>]) {
				identifier = identifier.replace(parArray[<span class="literal">"@name"</span>], parValue);													
			} <span class="reserved">else</span> {								
			    createInputElement(form, parArray[<span class="literal">"@name"</span>], parValue);	
				parameters += <span class="literal">"&amp;"</span> + parArray[<span class="literal">"@name"</span>] + <span class="literal">"="</span> + parValue;
			}
		}
	}		
	
	<span class="comment">// Check if the Proxy functionality is enabled</span>
	<span class="reserved">if</span> (proxyEnabled) {		
		var handler;
		switch (typeOfUse) {			
			case <span class="literal">"debug"</span>:			
				handler = <span class="reserved">function</span>(result) { alert(result); }
				htmlPostReq(identifier, parameters, handler);				
				break;
			case <span class="literal">"alertOccurrences"</span>: 		
				<span class="comment">// Get fieldSpec</span>
				var fieldSpec = service[<span class="literal">"sd:fieldSpec"</span>];
								
				<span class="reserved">if</span> ((fieldSpec != null) &amp;&amp; (fieldSpec != <span class="literal">""</span>)) {				
					handler = <span class="reserved">function</span>(result) {
						var numOfOccurrences = 0;
						
						String.<span class="reserved">prototype</span>.count = <span class="reserved">function</span>(char) {
							<span class="reserved">return</span> <span class="reserved">this</span>.split(char).length-1;
						}
						
						alert(<span class="literal">"Number of occurrences of \"</span><span class="literal">" + fieldSpec + "</span>\<span class="literal">": "</span> + result.count(fieldSpec));	
						<span class="comment">// TODO: Invoke nextService if &gt; 0</span>
					}
					htmlGetReq(url, handler);	
				}
				break;
			case <span class="literal">"replaceField"</span>:
				handler = <span class="reserved">function</span>(result) { pageDoc.getElementById(id).innerHTML = result;	} <span class="comment">// TODO: fieldSpec				</span>
				htmlPostReq(identifier, parameters, handler);				
				break;
			case <span class="literal">"replaceText"</span>:
				handler = <span class="reserved">function</span>(result) { 					
					var begin = 0; var length = 0; var endResult = <span class="literal">""</span>; var tmpResult = <span class="literal">""</span>;
										
					<span class="reserved">while</span> (result.substr(begin).indexOf(<span class="literal">"|{| "</span>) != -1) {						
						begin += result.substr(begin).indexOf(<span class="literal">"|{| "</span>) + 4;						
						length = result.substr(begin).indexOf(<span class="literal">" |}|"</span>);						
						tmpResult = result.substr(begin, length);
						<span class="reserved">if</span> ((endResult.indexOf(tmpResult) == -1) &amp;&amp; (tmpResult.indexOf(value.substr(4, value.length-8)) == -1)) {
							endResult = (endResult == <span class="literal">""</span>) ? tmpResult : endResult + <span class="literal">"&lt;br&gt;"</span> + tmpResult;							
						}
					}					
					pageDoc.getElementById(id).innerHTML = endResult;						
				} 				
				htmlPostReq(identifier, parameters, handler);				
				break;
			case <span class="literal">"createSearchList"</span>:				
				var fieldSpec = service[<span class="literal">"sd:fieldSpec"</span>];
				
				<span class="reserved">if</span> ((fieldSpec != null) &amp;&amp; (fieldSpec != <span class="literal">""</span>)) {								
					handler = <span class="reserved">function</span>(result) { 
						var fSpecs = fieldSpec.split(<span class="literal">"|"</span>);
						var contents = <span class="literal">"&lt;b&gt;Search list:&lt;/b&gt;&lt;br&gt;"</span>;
																						
						<span class="reserved">for</span> (var i=0; i&lt;fSpecs.length; i++) {
							<span class="reserved">if</span> (result.indexOf(fSpecs[i]) != -1) {
								var tmpStr = result;
								var response = <span class="literal">""</span>;
								
								<span class="reserved">while</span> (tmpStr.indexOf(<span class="literal">"&lt;"</span> + fSpecs[i] + <span class="literal">"&gt;"</span>) != -1) {									
									var firstOcc = tmpStr.indexOf(<span class="literal">"&lt;"</span> + fSpecs[i] + <span class="literal">"&gt;"</span>) + fSpecs[i].length + 2;								
									var tmpStr = tmpStr.substring(firstOcc);
									var endPos = tmpStr.indexOf(<span class="literal">"&lt;/"</span> + fSpecs[i] + <span class="literal">"&gt;"</span>);
									var currValue = tmpStr.substring(0, endPos);
									
									response += <span class="literal">"&lt;b&gt;&lt;li class=\"</span>citem\<span class="literal">" onclick=\"</span>searchItem(<span class="literal">'" + currValue + "'</span>)\<span class="literal">"&gt;"</span> + fSpecs[i] + <span class="literal">": &lt;/b&gt;"</span> + currValue + <span class="literal">"&lt;br&gt;"</span>;								
								}								
																
								<span class="reserved">if</span> (response != <span class="literal">""</span>) {									
									contents += response;
								} <span class="reserved">else</span> {
									contents = <span class="literal">"&lt;b&gt;No results&lt;/b&gt;"</span>;
								}							
							}							
						}
						createDiv(<span class="literal">"csDiv"</span>, contents);								
					} 							
					htmlGetReq(url, handler);										
				}
				break;
			default:
				pageDoc.body.appendChild(form);
				form.submit();
				pageDoc.body.removeChild(form);		
				break;
		}
	} <span class="reserved">else</span> {		
		pageDoc.body.appendChild(form);
		form.submit();
		pageDoc.body.removeChild(form);
	}
}

<span class="comment">/**
 * Creates an input element for form (used in runPostService())
 * <span class="attrib">@param</span> form the form in which the input element is to be placed.
 * <span class="attrib">@param</span> name the name of the input element.
 * <span class="attrib">@param</span> value the value of the input element.
 */</span>
<span class="reserved">function</span> createInputElement(form, name, value) {
	var input = document.createElement(<span class="literal">"input"</span>);
	input.type = <span class="literal">"hidden"</span>;
	input.name = name;
	input.value = value;
	form.appendChild(input);
}

<span class="comment">/**
 * Processes a service with access type JSON.
 * <span class="attrib">@param</span> service the service object of the service to be invoked.
 * <span class="attrib">@param</span> id the ID of the Metadata field which triggered the service. 
 * <span class="attrib">@param</span> value the contents of the Metadata field which triggered the service.
 */</span>
<span class="reserved">function</span> runJsonService(service, id, value) { 
	var identifier = getValueOfField(service, <span class="literal">"dc:identifier"</span>);		
	var parArray = service[<span class="literal">"sd:parameters"</span>];
	var	parameters = <span class="literal">""</span>;
	
	identifier = (identifier.indexOf(<span class="literal">"?"</span>) == -1) ? identifier + <span class="literal">"?"</span> : identifier;
	
	<span class="reserved">if</span> (parArray != null) {
		parArray = service[<span class="literal">"sd:parameters"</span>][<span class="literal">"sd:parameter"</span>];		
	} <span class="reserved">else</span> {
		parArray = service[<span class="literal">"sd:parameter"</span>];
	}
		
	value = trim(value);
	
	<span class="reserved">if</span> (parArray != null) {			
		<span class="reserved">if</span> (isArray(parArray)) {			
			<span class="reserved">for</span> (var i=0; i&lt;parArray.length;i++) {
				var currPar = parArray[i];
				
				<span class="comment">// Check for parameter["<span class="attrib">@substitute</span>"] (for identifier)</span>
				<span class="reserved">if</span> (currPar[<span class="literal">"@substitute"</span>] != null &amp;&amp; currPar[<span class="literal">"@substitute"</span>]) {					
					identifier = identifier.replace(currPar[<span class="literal">"@name"</span>], parseParameter(currPar, value));									
				} <span class="reserved">else</span> {
					parameters += <span class="literal">"&amp;"</span> + currPar[<span class="literal">"@name"</span>] + <span class="literal">"="</span> + parseParameter(currPar, value);				
				}
			}
		} <span class="reserved">else</span> {
			<span class="reserved">if</span> (parArray[<span class="literal">"@substitute"</span>] != null &amp;&amp; parArray[<span class="literal">"@substitute"</span>]) {
				identifier = identifier.replace(parArray[<span class="literal">"@name"</span>], parseParameter(parArray, value));									
			} <span class="reserved">else</span> {
			    parameters += <span class="literal">"&amp;"</span> + parArray[<span class="literal">"@name"</span>] + <span class="literal">"="</span> + parseParameter(parArray, value);
			}
		}
	}
	
	
	var url = identifier + parameters; <span class="comment">// + "&amp;callback=getJsonResponse";		</span>
	<span class="comment">// TODO: Replace ?&amp; -&gt; ? and &amp;&amp; -&gt; &amp;, also for JSON reqs</span>
	
	<span class="comment">// Build the JSON Request and add it to the queue</span>
	var jsonReq = [];	
	jsonReq[<span class="literal">"service"</span>] = service;
	jsonReq[<span class="literal">"id"</span>] = id;
	jsonReq[<span class="literal">"value"</span>] = value;
	jsonReq[<span class="literal">"url"</span>] = url;	
	jsonRequests.push(jsonReq);	
	
	<span class="comment">// Fire the queue, if it isn't processed already</span>
	<span class="reserved">if</span> (!jsonReqBusy) {
		executeJsonReq();		
	}
}

<span class="comment">/**
 * If no JSON request is processed, but if there is a request pending, process the request.
 */</span>
<span class="reserved">function</span> executeJsonReq() {
	<span class="reserved">if</span> (!jsonReqBusy &amp;&amp; jsonRequests.length &gt; 0) {	
		jsonReqBusy = true;
		jsonReq = jsonRequests[0];
		includeJS(jsonReq[<span class="literal">"url"</span>]);			
	}
}

<span class="comment">/**
 * Fetches the response of a JSON request.
 * <span class="attrib">@param</span> respons the response object.
 */</span>
<span class="reserved">function</span> getJsonResponse(response) {		
	var currJsonReq = jsonRequests.shift();

	var currService = currJsonReq[<span class="literal">"service"</span>];
	var currId = currJsonReq[<span class="literal">"id"</span>];
	var currValue = currJsonReq[<span class="literal">"value"</span>];
	
	var triggerName = getName(currId);
	var typeOfUse = getValueOfField(currService, <span class="literal">"sd:typeOfUse"</span>);
	var fieldSpec = getValueOfField(currService, <span class="literal">"sd:fieldSpec"</span>);
	var respObject = eval(<span class="literal">"response"</span>);
	var respText = print_r(respObject); <span class="comment">// Just in case no fieldSpec was provided</span>
	var unitName = <span class="literal">"items"</span>;
	
	
	<span class="comment">// Check if fieldSpec is given</span>
	<span class="reserved">if</span> ((fieldSpec != null) &amp;&amp; (fieldSpec != <span class="literal">""</span>)) {
		var fsObject = currService[<span class="literal">"sd:fieldSpec"</span>];
		
		respText = respObject;
		var tree = fieldSpec.split(<span class="literal">"."</span>);		
		
		<span class="reserved">for</span> (var i=0; i&lt;tree.length; i++) {			
			respText = respText[tree[i]];				
		}	
		
		<span class="comment">// Check for unitName</span>
		<span class="reserved">if</span> ((fsObject[<span class="literal">"@unitName"</span>] != null) &amp;&amp; (fsObject[<span class="literal">"@unitName"</span>] != <span class="literal">""</span>)) {			
			var unitLabel = fsObject[<span class="literal">"@unitName"</span>];
			var tree = unitLabel.split(<span class="literal">"."</span>);		
			var unitName = respObject;
			
			<span class="reserved">for</span> (var i=0; i&lt;tree.length; i++) {				
				unitName = unitName[tree[i]];			
			}			
		}	
	}
	
	switch (typeOfUse) {		
		case <span class="literal">"replaceField"</span>:						
			pageDoc.getElementById(currId).innerHTML = <span class="literal">" "</span> + respText;			
			break;					
		case <span class="literal">"addToField"</span>:						
			pageDoc.getElementById(currId).innerHTML += <span class="literal">" - "</span> + respText;			
			break;	
		case <span class="literal">"alertOccurrences"</span>: 
			<span class="reserved">if</span> ((fieldSpec != null) &amp;&amp; (fieldSpec != <span class="literal">""</span>)) {				
				var numOfOccurrences = 0;
				
				String.<span class="reserved">prototype</span>.count = <span class="reserved">function</span>(char) {
					<span class="reserved">return</span> <span class="reserved">this</span>.split(char).length-1;
				}
				respText = print_r(respObject);
				alert(respText.count(fieldSpec) + <span class="literal">" occurrences of \"</span><span class="literal">" + fieldSpec + "</span>\<span class="literal">" were found. "</span> + respText);	
					
				<span class="comment">// TODO: Invoke nextService if &gt; 0				</span>
			}
			break;			
		case <span class="literal">"alertIfResultCount"</span>:
			<span class="reserved">if</span> (parseInt(respText) &gt; 0) {
				alert(respText + <span class="literal">" occurrences of the type "</span> + unitName + <span class="literal">" were found of the object in the field "</span> + triggerName + <span class="literal">"."</span>);
			}
			break;		
		default:
			<span class="comment">// There should be a check for content-type TODO			</span>
			<span class="reserved">if</span> ((respText != null) &amp;&amp; (respText != <span class="literal">""</span>)) {
				alert(respText);						
			} <span class="reserved">else</span> {
				alert(print_r(respObject));
			}
			<span class="comment">//alert((respObject));								</span>
			break;
	}	
	
	<span class="comment">// Check for other JSON requests in the queue</span>
	jsonReqBusy = false;
	<span class="reserved">if</span> (jsonRequests.length &gt; 0) {
		executeJsonReq();
	}
}

<span class="comment">// Placeholders for access types which are not implemented yet (OpenSearch, SOAP, OAI and SPARQL)</span>
<span class="reserved">function</span> runOpenSearchService(service, id, value) { }
<span class="reserved">function</span> runSoapService(service, id, value) { }
<span class="reserved">function</span> runOaiService(service, id, value) { }
<span class="reserved">function</span> runSparqlService(service, id, value) { }

<span class="comment">/**
 * Helper method for the lookup table functionality of the parameters.
 * <span class="attrib">@param</span> entry the entry to be found in the map, the "needle".
 * <span class="attrib">@param</span> map the map containing all values, the "haystack".
 * <span class="attrib">@return</span> if found, the value of the entry. Else an empty String.
 */</span>
<span class="reserved">function</span> lookupEntryInMap(entry, map) {
	var value = <span class="literal">""</span>;
	var found = false;
	var i=0;

	<span class="reserved">while</span> (i&lt;map.length &amp;&amp; !found) {
		var gotHim = false;
		var currEntry = map[i][<span class="literal">"sd:val"</span>];		
		
		<span class="reserved">if</span> (isArray(entry)) {
			<span class="reserved">for</span> (var j=0; j&lt;entry.length; j++) {						
				gotHim = (currEntry[j] == entry[j]);									
			}
		} <span class="reserved">else</span> {
			gotHim = (currEntry[0] == entry);
		}
		
		<span class="reserved">if</span> (gotHim) {
			found = true;
			value = currEntry[currEntry.length-1];
			alert(value);
		}		
		i++;
	}	
	
	<span class="reserved">return</span> value;
}

<span class="comment">/**
 * Gets the value of a specific Services Description field.
 * <span class="attrib">@param</span> service the Services Description Object.
 * <span class="attrib">@param</span> field the requested field.
 * <span class="attrib">@return</span> if found, the value of the field. Else an empty String.
 */</span>
<span class="reserved">function</span> getValueOfField(service, field) {				
	<span class="reserved">if</span> (service[field]) {
		var value = service[field][<span class="literal">"#text"</span>] ? service[field][<span class="literal">"#text"</span>] : service[field];
		<span class="reserved">return</span> value;			
	} <span class="reserved">else</span> {
		<span class="reserved">return</span> <span class="literal">""</span>;
	}
}

<span class="comment">/**
 * Get the value of a Metadata field by its name.
 * <span class="attrib">@param</span> input the name of the requested Metadata field.
 * <span class="attrib">@return</span> if found, the value of the Metadata field. Else an empty String.
 */</span>
<span class="reserved">function</span> getValueOfMDF(input) {
	var value = input;		
	var results;
	
	<span class="comment">// Make an array of spans</span>
	<span class="reserved">if</span> (pageDoc.getElementsByTagName(<span class="literal">"span"</span>) != null) {
		results = pageDoc.getElementsByTagName(<span class="literal">"span"</span>);
	}
		
	var i=0;	
	<span class="comment">// Loop through the array trying to find the span with input as its name and siwa as its class</span>
	<span class="reserved">while</span> (i&lt;results.length) {		
		<span class="reserved">if</span> ((results[i].getAttribute(<span class="literal">"name"</span>) == input) &amp;&amp; results[i].className == <span class="literal">"siwa"</span>) {
			value = results[i].innerHTML;					
			break;
		}
		<span class="reserved">else</span> {
			i++;
		}
	}	
	
	<span class="reserved">return</span> value;	
}

<span class="comment">/**
 * Parses the contents of a parameter for substituting purposes.
 * <span class="attrib">@param</span> parValue the value of the parameter.
 * <span class="attrib">@param</span> triggerValue the value of the field which triggered the service.
 * <span class="attrib">@return</span> the parsed parameter value.
 */</span>
<span class="reserved">function</span> parseParValue(parValue, triggerValue) {				
	<span class="comment">// Replace triggerValue by the value of the MDF which triggered the service</span>
	<span class="reserved">if</span> (parValue.indexOf(<span class="literal">"_triggerValue"</span>) != -1) 		
		<span class="reserved">return</span> parValue.replace(<span class="literal">"_triggerValue"</span>, triggerValue);	
	
	<span class="comment">// Strip the leading "_"</span>
	<span class="reserved">if</span> (parValue.charAt(0) == <span class="literal">"_"</span>) {
		parValue = parValue.substring(1, parValue.length);
	}	
	
	<span class="comment">// Substitute where appropriate</span>
	<span class="reserved">if</span> (sessionArray[parValue] != null)	{
		<span class="comment">// If the requested parValue is in the session array, return the value</span>
		<span class="reserved">return</span> parValue.replace(parValue, sessionArray[parValue]);
	} <span class="reserved">else</span> <span class="reserved">if</span> (parValue.indexOf(<span class="literal">"triggerName"</span>) != -1) {
		<span class="comment">// Replace triggerName by the name of the MDF which triggered the service</span>
		<span class="reserved">return</span> getTriggerByValue(triggerValue);
	} <span class="reserved">else</span> {	
		parValue = getValueOfMDF(parValue);	
	}
	
	<span class="reserved">return</span> parValue;
}

<span class="comment">/**
 * Returns the Metadata field name by providing its contents. 
 * <span class="attrib">@param</span> triggerValue the value of the Metadata field.
 * <span class="attrib">@return</span> the name of the Metadata field with that contents.
 */</span>
<span class="reserved">function</span> getTriggerByValue(triggerValue) {	
	var spanName = <span class="literal">""</span>;
	var spanArray = pageDoc.getElementsByTagName(<span class="literal">"span"</span>);	
		
	<span class="reserved">for</span> (var i=0; i&lt;spanArray.length; i++) {
		<span class="reserved">if</span> (spanArray[i].className == <span class="literal">"siwa"</span>) {
			var currSpan = spanArray[i];			
						
			<span class="reserved">if</span> (currSpan.innerHTML == triggerValue) {				
				<span class="reserved">return</span> currSpan.getAttribute(<span class="literal">"name"</span>);
			} <span class="reserved">else</span> <span class="reserved">if</span> (currSpan.innerHTML.indexOf(triggerValue) != -1) {
				spanName = currSpan.getAttribute(<span class="literal">"name"</span>);
			}
		}
	}	
	<span class="reserved">return</span> spanName;
}

<span class="comment">/**
 * Helper function to be able to use createSearchList functionality to continue the search on the website.
 * <span class="attrib">@param</span> searchPhrase a String containing the phrase to be searched.
 */</span>
<span class="reserved">function</span> searchItem(searchPhrase) {
	var url = searchUrl + searchPhrase;	
	window.open(url, <span class="literal">""</span>, <span class="literal">""</span>);	
}


	<span class="comment">/**##################
	# Toolbox Functions #
	###################*/</span>

<span class="comment">/**
 * Checks if the object given is an array by checking its constructor. 
 * <span class="attrib">@obj</span> the object to be tested.
 * <span class="attrib">@return</span> true if the object is an array.
 */</span> 
<span class="reserved">function</span> isArray(obj) {
	<span class="reserved">if</span> (obj.constructor.toString().indexOf(<span class="literal">"Array"</span>) == -1) {
		<span class="reserved">return</span> false;
	} <span class="reserved">else</span> {
		<span class="reserved">return</span> true;
	}
}

<span class="comment">/**
 * A Javascript implementation of the PHP method print_r. Shows the structure of an object.
 * <span class="attrib">@param</span> theObj the object to be printed.
 * <span class="attrib">@return</span> a String containing the structure of the object.
 */</span>
<span class="reserved">function</span> print_r(theObj){
	var result = <span class="literal">""</span>;
	
	<span class="reserved">if</span> (theObj.constructor == Array || theObj.constructor == Object) {		
		<span class="reserved">for</span> (var p in theObj) {
			<span class="reserved">if</span> (theObj[p] != null) {
				<span class="reserved">if</span> (theObj[p].constructor == Array || theObj[p].constructor == Object) {
					result += <span class="literal">"["</span>+p+<span class="literal">"] =&gt; "</span>+typeof(theObj);				
					result += print_r(theObj[p]);				
				} <span class="reserved">else</span> {
					result += <span class="literal">"["</span>+p+<span class="literal">"] =&gt; "</span>+theObj[p];
					<span class="comment">//result += theObj[p];</span>
				}
			} 
		}		
	} <span class="reserved">else</span> {
		result = theObj;
	}
	<span class="reserved">return</span> result;
}

<span class="comment">/**
 * Trims a String. 
 * <span class="attrib">@param</span> value the String to be trimmed.
 * <span class="attrib">@return</span> the trimmed String.
 */</span>
<span class="reserved">function</span> trim(value) {
	value = value.replace(/^\s+/,<span class="literal">''</span>);
	value = value.replace(/\s+$/,<span class="literal">''</span>);
	<span class="reserved">return</span> value;
}

--&gt;</pre>
	<hr>



<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> <font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top"><em>
<b></b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<font size="-1">

</font>
<div class="jsdoc_ctime">Documentation generated by <a href="http://jsdoc.sourceforge.net/" target="_parent">JSDoc</a> on Thu May  6 15:04:02 2010</div>
</body>
</html>
